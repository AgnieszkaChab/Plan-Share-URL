{% extends "base.html" %}
{% load static %}

{% block content %}
<header class="h-[20vh] max-h-[160px] relative px-2 md:px-8 bg-white shadow-sm">
    <div class="absolute bottom-0 left-0 p-4">
        <p class="text-black font-bold text-2xl">{{ author_plan_slot.slot|date:"F j, Y" }}</p>
    </div>
    <div class="absolute top-0 left-0 p-4 flex flex-col gap-2 items-start">
        <h3 class="text-lg md:text-lg font-bold text-gray-900">Modify the Plan in the App</h3>
        <button onclick="trackEvent('cta_click', {location: 'header', type: 'modify_plan'})" class="flex items-center justify-center gap-2 w-32 px-3 py-1.5 bg-primary hover:bg-primary/90 text-white text-sm font-medium rounded-full transition">
            <i data-feather="edit" class="h-3.5 w-3.5"></i>
            Modify Plan
        </button>
    </div>
    <img src="{% static 'images/logo.png' %}" alt="GYM Planner Logo" class="h-full max-h-[100px] w-auto absolute right-0 pr-4 md:pr-8 hovered-element">
</header>

<main>
    <section class="min-h-[40vh] py-0 px-0">
        <div data-aos="fade-left" class="relative h-full w-full min-h-[50vh]">
            <img src="{% static 'images/hero.jpg' %}" alt="Gym" class="absolute inset-0 w-full h-full object-cover hovered-element brightness-50">
            <div class="absolute bottom-0 left-0 p-6 md:p-8 bg-black/0 text-white w-full">
                <h1 class="text-3xl md:text-4xl font-bold font-sans" style="font-family: Arial, sans-serif;">{{ plan.title }}</h1>
                {% if muscle_groups %}
                <div class="flex flex-col items-center justify-center mt-1">
                    <p class="text-white font-medium text-sm">Engaged Muscles:</p>
                    <div class="flex gap-2 mt-1 flex-wrap justify-center">
                        {% for muscle in muscle_groups %}
                            <span class="bg-primary text-white font-medium px-2 py-0.5 rounded-full text-sm">{{ muscle }}</span>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}
            </div>
        </div>
    </section>

    <section class="min-h-[10vh] bg-white py-8 px-4 border-y border-gray-200">
        <div data-aos="fade-up" class="container mx-auto max-w-full">
            <div class="flex flex-col md:flex-row justify-between gap-6 mb-6">
                <div class="flex items-center gap-4">
                    {% if plan.author %}
                        <img src="{{ plan.author.avatar_url }}" class="rounded-full w-20 h-20 object-cover border-0 border-primary" alt="Sharer">
                    {% else %}
                        <div class="rounded-full w-20 h-20 bg-gray-300 flex items-center justify-center">
                            <span class="text-gray-600 text-sm">?</span>
                        </div>
                    {% endif %}
                    <div>
                        <p class="font-bold text-3xl" style="font-family: Arial, sans-serif; font-weight: 800;">{{ plan.author.username|default:"Anonymous" }}</p>
                        <p class="font-semibold italic text-gray-500">Shared this plan</p>
                        {% if plan.author.description %}
                        <p class="text-gray-700 max-w-2xl mt-2">{{ plan.author.description }}</p>
                        {% endif %}
                    </div>
                </div>
                <div class="flex flex-col md:flex-row gap-4 justify-center items-center w-full md:w-auto">
                    <div class="flex items-center gap-2">
                        <h3 class="text-sm font-medium text-gray-500">TIME</h3>
                        <p class="font-medium">{{ author_plan_slot.slot|date:"H:i" }}</p>
                    </div>
                    {% if plan.duration %}
                    <div class="flex items-center gap-2">
                        <h3 class="text-sm font-medium text-gray-500">DURATION</h3>
                        <p class="font-medium">{{ plan.duration }} min</p>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </section>

    <section class="py-12 px-4">
        <div class="container mx-auto max-w-full">
            <h2 class="text-2xl font-bold text-gray-900 mb-8">Workout Exercises</h2>

            <div class="space-y-8">
                {% for exercise in exercises %}
                <div data-aos="fade-up" class="bg-white p-6 rounded-2xl shadow-sm flex flex-col md:flex-row gap-6 items-start relative">
                    <span class="absolute -left-2 -top-2 bg-primary text-white font-bold rounded-full w-8 h-8 flex items-center justify-center">{{ forloop.counter }}</span>
                    {% if exercise.exercise.thumbnail %}
                        <img src="{{ exercise.exercise.thumbnail.url }}" class="rounded-xl w-40 h-40 object-cover flex-shrink-0" alt="{{ exercise.exercise.name }}">
                    {% else %}
                        <div class="rounded-xl w-40 h-40 bg-gray-200 flex items-center justify-center flex-shrink-0">
                            <span class="text-gray-500">No Image</span>
                        </div>
                    {% endif %}
                    <div class="flex-1 min-w-0">
                        <div class="w-full">
                            <h3 class="text-xl font-bold text-gray-900">{{ exercise.exercise.name }}</h3>
                            {% if exercise.exercise.muscle_group %}
                            <span class="text-base font-bold bg-primary/10 text-primary px-0 py-1 rounded mt-1">{{ exercise.exercise.muscle_group.name }}</span>
                            {% endif %}
                        </div>
                        <div class="flex gap-6 w-full mt-2">
                            {% if exercise.sets %}
                            <div class="flex items-center gap-3">
                                <h4 class="text-base font-medium text-gray-500">SETS</h4>
                                <p class="font-bold text-xl border border-gray-300 px-6 py-1 rounded">{{ exercise.sets }}</p>
                            </div>
                            {% endif %}
                            <div class="flex items-center gap-3">
                                <h4 class="text-base font-medium text-gray-500">{{ exercise.unit|upper }}</h4>
                                <p class="font-bold text-xl border border-gray-300 px-6 py-1 rounded">{{ exercise.quantity }}</p>
                            </div>
                        </div>
                        {% if exercise.comment %}
                        <div class="mt-4">
                            <h4 class="text-sm font-medium text-gray-500">DESCRIPTION:</h4>
                            <p class="text-gray-700">{{ exercise.comment }}</p>
                        </div>
                        {% endif %}
                    </div>
                </div>
                {% empty %}
                <p class="text-gray-500 text-center">No exercises in this plan.</p>
                {% endfor %}
            </div>
        </div>
    </section>
</main>

<footer class="min-h-[10vh] bg-white border-t border-gray-200 py-12 px-4">
    <div data-aos="fade-up" class="container mx-auto max-w-3xl text-center">
        <h2 class="text-2xl md:text-3xl font-bold text-gray-900">Modify the Plan in the App</h2>

        <div class="flex flex-col sm:flex-row justify-center gap-4 mb-8 mt-6">
            <button onclick="trackEvent('cta_click', {location: 'footer', type: 'modify_plan'})" class="flex items-center justify-center gap-2 w-40 px-4 py-2 mx-auto bg-primary hover:bg-primary/90 text-white font-medium rounded-full transition">
                <i data-feather="edit" class="h-4 w-4"></i>
                Modify Plan
            </button>
        </div>

        <p class="text-gray-600 mb-6">Download the app to save and customize this plan</p>

        <div class="flex flex-wrap justify-center gap-4">
            <a href="https://play.google.com/store/apps/details?id=com.gmplanner.app&hl=en" onclick="trackEvent('cta_click', {location: 'footer', type: 'google_play'})" class="flex items-center gap-2">
                <img src="{% static 'images/google-play.jpg' %}" alt="App Store" class="h-14">
            </a>
            <a href="https://apps.apple.com/us/app/gm-planner/id6748095652" onclick="trackEvent('cta_click', {location: 'footer', type: 'app_store'})" class="flex items-center gap-2">
                <img src="{% static 'images/apple.jpg' %}" alt="Google Play" class="h-14">
            </a>
        </div>
    </div>
</footer>

<script>
    if (!document.cookie.match(/timezone=/)) {
        const timezone = Intl.DateTimeFormat().resolvedOptions().timeZone;
        document.cookie = `timezone=${timezone}; path=/; max-age=31536000; SameSite=Lax`;
        location.reload();
    }
</script>
{% endblock %}
